parameters:
  - name: stage
    type: string
  - name: targets
    type: object

stages:
  - stage: ${{ parameters.stage }}
    displayName: ${{ parameters.stage }}
    dependsOn: []
    jobs:
      - ${{ each target in parameters.targets }}:
        - template: test.yml
          parameters:
            job: ${{ target.test }}
            test: ${{ target.test }}
            name: ${{ target.name }}
