parameters:
  - name: stage
    type: string
  - name: name
    type: string
    default: ""
  - name: jobs
    type: object

stages:
  - stage: ${{ parameters.stage }}
    displayName: ${{ coalesce(parameters.name, parameters.stage) }}
    dependsOn: []
    jobs:
      - ${{ each job in parameters.jobs }}:
        - job: ${{ replace(replace(replace(job.job, '/', '_'), '.', '_'), '-', '_') }}
          displayName: ${{ job.name }}
          container: default
          workspace:
            clean: all
          steps:
            - checkout: self
              fetchDepth: ${{variables.fetchDepth}}
              path: ${{variables.checkoutPath}}
            - bash: echo ${{ lower(job.test) }}
              displayName: Run Tests
